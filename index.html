<!--
  do something with optionally provided photo
-->

<!doctype html>
<!--[if lt IE 9]>  <html class="ie lt-ie9 ie8"> <![endif]-->
<!--[if IE 9]>     <html class="ie ie9"> <![endif]-->
<!--[if !IE]><!--> <html> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Esri Bikeshare Counter</title>
    <!--link rel="shortcut icon" href="/img/favicon.ico"-->
    <link rel="stylesheet" href="https://s3-us-west-1.amazonaws.com/patterns.esri.com/files/calcite-web/1.0.0-rc.9/css/calcite-web.min.css">
    <!--[if lt IE 9]>
      <script src="/assets/javascripts/libs/selectivizr.js"></script>
      <script src="/assets/javascripts/libs/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <div class="grid-container">
        <div class="column-7 tablet-column-3">
          <div>...</div>
        </div>
        <div class="column-10 tablet-column-6">
          <h1 class="leader-3" >Esri bikeshare</h1>
          <!--form action="" method="POST"-->

            <fieldset class="fieldset-radio">
              <legend>How many bikes did you borrow?</legend>
              <label>
                  <input checked type="radio" name="source" value=0>None
                </label>
              <label>
                <input checked type="radio" name="source" value=1>Just one
              </label>
              <label>
                <input type="radio" name="source" value=2>More than one
              </label>
            </fieldset>
            <label>
              When?
              <input id="bikeshareDate" type="date" placeholder="mm/dd/yyyy" value="2001-02-03" required>
            </label>
            <label>
              Do you have any feedback? (optional)
              <textarea id="feedback" placeholder="loaner bike #2 has a flat tire!" rows="5"></textarea>
            </label>
            <!--label>
              What is your email address? (optional)
              <input id="contact" type="email" placeholder="jack@esri.com" autocomplete="email">
            </label>
            <label>
              Want to share a photo? (optional)
              <input type="file">
            </label-->
            <button onclick="postFeedback()" type="submit" class="btn">Submit</button>
            <div class="leader-1">
              <span id="results"></span>
            </div>
          <!--/form-->

        </div>
        <div class="column-7 tablet-column-3">
            <div>...</div>
          </div>
      </div>

    </div>
    <div class="footer leader-1" role="contentinfo">
      <!-- content of footer -->
      <div class="grid-container">
        <div class="column-24">
            <p>
                <small>
                    <a href="https://www.esri.com/legal/copyright-trademarks">Copyright Â© 2018 Esri</a>. All rights reserved. |
                    <a href="https://www.esri.com/legal/privacy">Privacy</a> |
                    <a href="https://www.esri.com/legal/software-license">Terms of use</a> |
                    <a href="https://developers.arcgis.com/terms/faq/">FAQ</a>
                </small>
              </p>
        </div>
      </div>
    </div>

    <!-- get calcite-web js from the cdn (use latest version) -->
    <script src="https://s3-us-west-1.amazonaws.com/patterns.esri.com/files/calcite-web/1.0.0-rc.9/js/calcite-web.min.js"></script>
    <script src="https://unpkg.com/@esri/arcgis-rest-request@1.1.1/dist/umd/arcgis-rest-request.umd.min.js"></script>

    <!-- interactive patterns need to be initialized -->
    <script>
      calcite.init()

      function postFeedback (evt) {
        const url = "https://services.arcgis.com/uCXeTVveQzP4IIcx/ArcGIS/rest/services/stationActivity/FeatureServer/1/applyEdits";
        arcgisRest.request(url, {
          params: {
            adds: [{
              attributes: {
                "STATION_ID": 0, // building M
                "TIMESTAMP": document.getElementById("bikeshareDate").value,
                "COMMENTS": document.getElementById("feedback").value,
                "_USER": document.getElementById("contact").value
              }
            }]
          }
        })
          .then(response => {
            if (response.addResults.length > 0) {
              document.getElementById("results").innerHTML = "Your log has been submitted. Thank you!"
            }
            // use OBJECTID that is returned to append a file attachment if one has been supplied.
            // if () {
            // }
          });
      }

      function todayFormatted () {
        const today = new Date();
        let dd = today.getDate();
        let mm = today.getMonth() + 1; // January is 0!

        if (dd < 10) {
            dd = '0' + dd;
        }
        if (mm < 10){
            mm = '0' + mm;
        }
        return today.getFullYear() + '-' + mm + '-' + dd;
      }

      // use today's date by default
      document.getElementById("bikeshareDate").value = todayFormatted();
    </script>
  </body>
</html>